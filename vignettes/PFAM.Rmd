---
vignette: >
  % \VignetteIndexEntry{PFAM domain-domain association analysis}
  % \VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
output:
  html_document:
    mathjax: null   
---

# Setup

```{r, message = FALSE}
library(BioPlex)
library(AnnotationDbi)
library(AnnotationHub)
library(graph)
```

Get the latest version of the 293T PPI network and the HCT116 PPI network:

```{r}
bp.293t <- BioPlex::getBioPlex(cell.line = "293T", version = "3.0")
bp.hct116 <- BioPlex::getBioPlex(cell.line = "HCT116", version = "1.0")
```

and turn into a graph object:

```{r}
bp.gr <- BioPlex::bioplex2graph(bp.293t)
hct.gr <- BioPlex::bioplex2graph(bp.hct116)
```

Annotate PFAM domains to the node metadata:

Connect to 
[AnnotationHub](http://bioconductor.org/packages/AnnotationHub):

```{r ahub, message = FALSE}
ah <- AnnotationHub::AnnotationHub()
```

OrgDb package for human:
```{r orgdb, message = FALSE}
orgdb <- AnnotationHub::query(ah, c("orgDb", "Homo sapiens"))
orgdb <- orgdb[[1]] 
orgdb
AnnotationDbi::keytypes(orgdb)
```

```{r pfam}
bp.gr <- BioPlex::annotatePFAM(bp.gr, orgdb)
hct.gr <- BioPlex::annotatePFAM(hct.gr, orgdb)
```

Domain-domain association analysis:

```{r}
res.bp <- BioPlexAnalysis::testDomainAssociation(bp.gr)
head(res.bp)
res.hct <- BioPlexAnalysis::testDomainAssociation(hct.gr)
head(res.hct)
```

Get human readable description for the PFAM domain IDs:

```{r}
library(PFAM.db)
id2de <- as.list(PFAMDE)
```

What are the top 10 interacting domain pairs for the 293T network:

```{r}
top10a <- head(res.bp$PFAM1, 10)
top10b <- head(res.bp$PFAM2, 10)
data.frame(DOMAIN1 = unlist(id2de[top10a]),
           DOMAIN2 = unlist(id2de[top10b]))
```

What are the top 10 interacting domain pairs for the HCT116 network:

```{r}
top10ah <- head(res.hct$PFAM1, 10)
top10bh <- head(res.hct$PFAM2, 10)
data.frame(DOMAIN1 = unlist(id2de[top10ah]),
           DOMAIN2 = unlist(id2de[top10bh]))
```

Plot association strength grid:

```{r}
top10ab <- unique(c(top10a, top10b))
ind <- res.bp$PFAM1 %in% top10ab & res.bp$PFAM2 %in% top10ab 
top.res.bp <- res.bp[ind,] 
mat <- reshape2::acast(top.res.bp, PFAM1 ~ PFAM2, value.var = "ADJ.PVAL")
mat <- -log10(mat)
```
